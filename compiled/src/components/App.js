import MovieList from './MovieList.js';
import Search from './Search.js';
import Add from './Add.js';
import MovieInfo from './MovieInfo.js';
// import {search} from '../lib/searchOMDB.js'

class App extends React.Component {
  constructor(props) {
    super(props);

    this.state = {
      movieList: [],
      fullList: [],
      watched: [],
      searchInput: '',
      addInput: '',
      year: '1345',
      runtime: '123',
      metascore: '12344'
    };
  }

  queryTMDB(query) {
    var query = query.split(' ').join('+');
    var APIKey = "d625af18b14f003c9fc09de5c2f93de8";
    var searchURL = "https://api.themoviedb.org/3/search/movie?api_key=" + APIKey + "&query=" + query;

    fetch(searchURL).then(data => {
      return data.json();
    }).then(data => {
      console.log(data.results[0]);
      var id = data.results[0].id;
      var detailURL = "https://api.themoviedb.org/3/movie/" + id + "?api_key=" + APIKey;
      fetch(detailURL).then(body => {
        return body.json();
      }).then(body => {
        console.log(body);
        this.setState({
          year: body.release_date.slice(0, 4),
          runtime: body.runtime,
          metascore: body.vote_average
        });
      });
    });
  }

  showInfo(e) {
    // call request with e.target.title as query
    // when data is received, parse data, and send it down to movie info where
    // it can be rendered
    var entry = e.target.title;
    var view = document.getElementById(entry).style.display;
    this.queryTMDB(entry);
    if (view === "none") {
      view = "block";
    } else if (view === "block") {
      view = "none";
    }
    document.getElementById(entry).style.display = view;
  }

  showAll() {
    this.setState({
      movieList: this.state.fullList
    });
  }

  filterWatched() {
    this.setState({
      movieList: this.state.watched
    });
  }

  filterToWatch() {
    var allMovies = this.state.fullList;
    var toWatch = [];

    for (var i = 0; i < allMovies.length; i++) {
      if (!this.state.watched.includes(allMovies[i])) {
        toWatch.push(allMovies[i]);
      }
    }

    this.setState({
      movieList: toWatch
    });
  }

  watchedClick(e) {
    var prevWatched = this.state.watched.slice(0);
    var movie = e.target.value;
    console.log(prevWatched);
    if (!prevWatched.includes(movie)) {
      prevWatched.push(movie);
    } else {
      prevWatched = this.removeMovie(prevWatched, movie);
    }
    this.setState({
      watched: prevWatched
    });
  }

  removeMovie(watched, movie) {
    return watched.filter(function (ele) {
      return ele != movie;
    });
  }

  handleInput(e) {
    if (e.target.id === 'add') {
      this.setState({
        addInput: e.target.value
      });
    } else if (e.target.id === 'search') {
      this.setState({
        searchInput: e.target.value
      });
    }
  }

  keyPress(e) {
    if (e.keyCode === 13) {
      if (e.target.id === 'add') {
        this.handleAdd(this.state.addInput);
      } else if (e.target.id === 'search') {
        this.handleSearch(this.state.searchInput);
      }
    };
  }

  handleSearch() {
    if (this.state.searchInput === '') {
      this.setState({
        movieList: this.state.fullList
      });
      return;
    }

    var matches = [];
    for (var i = 0; i < this.state.fullList.length; i++) {
      if (this.state.fullList[i].toLowerCase().includes(this.state.searchInput.toLowerCase())) {
        matches.push(this.state.fullList[i]);
      }
    }

    if (matches.length > 0) {
      this.setState({
        movieList: matches,
        searchInput: ''
      });
    } else {
      this.setState({
        movieList: ['movie not available'],
        searchInput: ''
      });
    }
  }

  handleAdd() {
    if (this.state.addInput === '') {
      return;
    }
    this.setState({
      fullList: [...this.state.fullList, this.state.addInput],
      movieList: [...this.state.fullList, this.state.addInput],
      addInput: ''
    });
  }

  render() {
    return React.createElement(
      'div',
      null,
      React.createElement(
        'div',
        null,
        React.createElement(
          'span',
          null,
          React.createElement(
            'button',
            { className: 'filter_watched', onClick: this.filterWatched.bind(this) },
            'watched'
          ),
          React.createElement(
            'button',
            { className: 'filter_not_watched', onClick: this.filterToWatch.bind(this) },
            'watch'
          ),
          React.createElement(
            'button',
            { className: 'show_all', onClick: this.showAll.bind(this) },
            'show all'
          )
        )
      ),
      React.createElement(Add, {
        value: this.state.addInput,
        handleInput: this.handleInput.bind(this),
        handleAdd: this.handleAdd.bind(this),
        onKeyDown: this.keyPress.bind(this)
      }),
      React.createElement(Search, {
        value: this.state.searchInput,
        handleInput: this.handleInput.bind(this),
        handleSearch: this.handleSearch.bind(this),
        onKeyDown: this.keyPress.bind(this)
      }),
      React.createElement(MovieList, {
        movieList: this.state.movieList,
        watchedClick: this.watchedClick.bind(this),
        watched: this.state.watched,
        showInfo: this.showInfo.bind(this),
        year: this.state.year,
        runtime: this.state.runtime,
        metascore: this.state.metascore
      })
    );
  }
};

export default App;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9jb21wb25lbnRzL0FwcC5qc3giXSwibmFtZXMiOlsiTW92aWVMaXN0IiwiU2VhcmNoIiwiQWRkIiwiTW92aWVJbmZvIiwiQXBwIiwiUmVhY3QiLCJDb21wb25lbnQiLCJjb25zdHJ1Y3RvciIsInByb3BzIiwic3RhdGUiLCJtb3ZpZUxpc3QiLCJmdWxsTGlzdCIsIndhdGNoZWQiLCJzZWFyY2hJbnB1dCIsImFkZElucHV0IiwieWVhciIsInJ1bnRpbWUiLCJtZXRhc2NvcmUiLCJxdWVyeVRNREIiLCJxdWVyeSIsInNwbGl0Iiwiam9pbiIsIkFQSUtleSIsInNlYXJjaFVSTCIsImZldGNoIiwidGhlbiIsImRhdGEiLCJqc29uIiwiY29uc29sZSIsImxvZyIsInJlc3VsdHMiLCJpZCIsImRldGFpbFVSTCIsImJvZHkiLCJzZXRTdGF0ZSIsInJlbGVhc2VfZGF0ZSIsInNsaWNlIiwidm90ZV9hdmVyYWdlIiwic2hvd0luZm8iLCJlIiwiZW50cnkiLCJ0YXJnZXQiLCJ0aXRsZSIsInZpZXciLCJkb2N1bWVudCIsImdldEVsZW1lbnRCeUlkIiwic3R5bGUiLCJkaXNwbGF5Iiwic2hvd0FsbCIsImZpbHRlcldhdGNoZWQiLCJmaWx0ZXJUb1dhdGNoIiwiYWxsTW92aWVzIiwidG9XYXRjaCIsImkiLCJsZW5ndGgiLCJpbmNsdWRlcyIsInB1c2giLCJ3YXRjaGVkQ2xpY2siLCJwcmV2V2F0Y2hlZCIsIm1vdmllIiwidmFsdWUiLCJyZW1vdmVNb3ZpZSIsImZpbHRlciIsImVsZSIsImhhbmRsZUlucHV0Iiwia2V5UHJlc3MiLCJrZXlDb2RlIiwiaGFuZGxlQWRkIiwiaGFuZGxlU2VhcmNoIiwibWF0Y2hlcyIsInRvTG93ZXJDYXNlIiwicmVuZGVyIiwiYmluZCJdLCJtYXBwaW5ncyI6IkFBQUEsT0FBT0EsU0FBUCxNQUFzQixnQkFBdEI7QUFDQSxPQUFPQyxNQUFQLE1BQW1CLGFBQW5CO0FBQ0EsT0FBT0MsR0FBUCxNQUFnQixVQUFoQjtBQUNB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QVdJLFdBRHBCO0FBRUUscUJBQWEsS0FBS21ELFdBQUwsQ0FBaUJRLElBQWpCLENBQXNCLElBQXRCLENBRmY7QUFHRSxzQkFBYyxLQUFLSixZQUFMLENBQWtCSSxJQUFsQixDQUF1QixJQUF2QixDQUhoQjtBQUlFLG1CQUFXLEtBQUtQLFFBQUwsQ0FBY08sSUFBZCxDQUFtQixJQUFuQjtBQUpiLFFBaEJGO0FBc0JFLDBCQUFDLFNBQUQ7QUFDRSxtQkFBVyxLQUFLL0QsS0FBTCxDQUFXQyxTQUR4QjtBQUVFLHNCQUFjLEtBQUsrQyxZQUFMLENBQWtCZSxJQUFsQixDQUF1QixJQUF2QixDQUZoQjtBQUdFLGlCQUFTLEtBQUsvRCxLQUFMLENBQVdHLE9BSHRCO0FBSUUsa0JBQVUsS0FBSzBCLFFBQUwsQ0FBY2tDLElBQWQsQ0FBbUIsSUFBbkIsQ0FKWjtBQUtFLGNBQU0sS0FBSy9ELEtBQUwsQ0FBV00sSUFMbkI7QUFNRSxpQkFBUyxLQUFLTixLQUFMLENBQVdPLE9BTnRCO0FBT0UsbUJBQVcsS0FBS1AsS0FBTCxDQUFXUTtBQVB4QjtBQXRCRixLQURGO0FBa0NEO0FBNU0rQixDQThNakM7O0FBRUQsZUFBZWIsR0FBZiIsImZpbGUiOiJBcHAuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgTW92aWVMaXN0IGZyb20gJy4vTW92aWVMaXN0LmpzJztcbmltcG9ydCBTZWFyY2ggZnJvbSAnLi9TZWFyY2guanMnO1xuaW1wb3J0IEFkZCBmcm9tICcuL0FkZC5qcyc7XG5pbXBvcnQgTW92aWVJbmZvIGZyb20gJy4vTW92aWVJbmZvLmpzJ1xuLy8gaW1wb3J0IHtzZWFyY2h9IGZyb20gJy4uL2xpYi9zZWFyY2hPTURCLmpzJ1xuXG5jbGFzcyBBcHAgZXh0ZW5kcyBSZWFjdC5Db21wb25lbnQge1xuICBjb25zdHJ1Y3Rvcihwcm9wcykge1xuICAgIHN1cGVyKHByb3BzKTtcblxuICAgIHRoaXMuc3RhdGUgPSB7XG4gICAgICBtb3ZpZUxpc3Q6IFtdLFxuICAgICAgZnVsbExpc3Q6IFtdLFxuICAgICAgd2F0Y2hlZDogW10sXG4gICAgICBzZWFyY2hJbnB1dDogJycsXG4gICAgICBhZGRJbnB1dDogJycsXG4gICAgICB5ZWFyOiAnMTM0NScsXG4gICAgICBydW50aW1lOiAnMTIzJyxcbiAgICAgIG1ldGFzY29yZTogJzEyMzQ0J1xuICAgIH1cbiAgfVxuXG4gIHF1ZXJ5VE1EQihxdWVyeSkge1xuICAgIHZhciBxdWVyeSA9IHF1ZXJ5LnNwbGl0KCcgJykuam9pbignKycpXG4gICAgdmFyIEFQSUtleSA9IFwiZDYyNWFmMThiMTRmMDAzYzlmYzA5ZGU1YzJmOTNkZThcIlxuICAgIHZhciBzZWFyY2hVUkwgPSBcImh0dHBzOi8vYXBpLnRoZW1vdmllZGIub3JnLzMvc2VhcmNoL21vdmllP2FwaV9rZXk9XCIgKyBBUElLZXkgKyBcIiZxdWVyeT1cIiArIHF1ZXJ5O1xuICAgIFxuICAgIGZldGNoKHNlYXJjaFVSTClcbiAgICAudGhlbihkYXRhID0+IHtcbiAgICAgIHJldHVybiBkYXRhLmpzb24oKVxuICAgIH0pXG4gICAgLnRoZW4oZGF0YSA9PiB7XG4gICAgICBjb25zb2xlLmxvZyhkYXRhLnJlc3VsdHNbMF0pXG4gICAgICB2YXIgaWQgPSBkYXRhLnJlc3VsdHNbMF0uaWQgXG4gICAgICB2YXIgZGV0YWlsVVJMID0gXCJodHRwczovL2FwaS50aGVtb3ZpZWRiLm9yZy8zL21vdmllL1wiICsgaWQgKyBcIj9hcGlfa2V5PVwiICsgQVBJS2V5O1xuICAgICAgZmV0Y2goZGV0YWlsVVJMKVxuICAgICAgLnRoZW4oYm9keSA9PiB7XG4gICAgICAgIHJldHVybiBib2R5Lmpzb24oKTtcbiAgICAgIH0pXG4gICAgICAudGhlbihib2R5ID0+IHtcbiAgICAgICAgY29uc29sZS5sb2coYm9keSk7XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICAgIHllYXI6IGJvZHkucmVsZWFzZV9kYXRlLnNsaWNlKDAsNCksXG4gICAgICAgICAgcnVudGltZTogYm9keS5ydW50aW1lLFxuICAgICAgICAgIG1ldGFzY29yZTogYm9keS52b3RlX2F2ZXJhZ2VcbiAgICAgICAgfSlcbiAgICAgIH0pXG4gICAgICB9KVxuICAgIH1cblxuXG4gIHNob3dJbmZvKGUpIHtcbiAgICAvLyBjYWxsIHJlcXVlc3Qgd2l0aCBlLnRhcmdldC50aXRsZSBhcyBxdWVyeVxuICAgIC8vIHdoZW4gZGF0YSBpcyByZWNlaXZlZCwgcGFyc2UgZGF0YSwgYW5kIHNlbmQgaXQgZG93biB0byBtb3ZpZSBpbmZvIHdoZXJlXG4gICAgLy8gaXQgY2FuIGJlIHJlbmRlcmVkXG4gICAgdmFyIGVudHJ5ID0gZS50YXJnZXQudGl0bGVcbiAgICB2YXIgdmlldyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGVudHJ5KS5zdHlsZS5kaXNwbGF5XG4gICAgdGhpcy5xdWVyeVRNREIoZW50cnkpXG4gICAgaWYgKHZpZXcgPT09IFwibm9uZVwiKSB7XG4gICAgICB2aWV3ID0gXCJibG9ja1wiXG4gICAgfSBlbHNlIGlmICh2aWV3ID09PSBcImJsb2NrXCIpIHtcbiAgICAgIHZpZXcgPSBcIm5vbmVcIlxuICAgIH1cbiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChlbnRyeSkuc3R5bGUuZGlzcGxheSA9IHZpZXc7XG4gIH1cblxuICBzaG93QWxsKCkge1xuICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgbW92aWVMaXN0OiB0aGlzLnN0YXRlLmZ1bGxMaXN0XG4gICAgfSlcbiAgfVxuXG4gIGZpbHRlcldhdGNoZWQoKSB7XG4gICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICBtb3ZpZUxpc3Q6IHRoaXMuc3RhdGUud2F0Y2hlZFxuICAgIH0pXG4gIH1cblxuICBmaWx0ZXJUb1dhdGNoKCkge1xuICAgIHZhciBhbGxNb3ZpZXMgPSB0aGlzLnN0YXRlLmZ1bGxMaXN0XG4gICAgdmFyIHRvV2F0Y2ggPSBbXTtcblxuICAgIGZvcih2YXIgaSA9IDA7IGkgPCBhbGxNb3ZpZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgIGlmKCF0aGlzLnN0YXRlLndhdGNoZWQuaW5jbHVkZXMoYWxsTW92aWVzW2ldKSkge1xuICAgICAgICB0b1dhdGNoLnB1c2goYWxsTW92aWVzW2ldKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgIG1vdmllTGlzdDogdG9XYXRjaFxuICAgIH0pXG4gIH1cblxuICB3YXRjaGVkQ2xpY2soZSkge1xuICAgIHZhciBwcmV2V2F0Y2hlZCA9IHRoaXMuc3RhdGUud2F0Y2hlZC5zbGljZSgwKVxuICAgIHZhciBtb3ZpZSA9IGUudGFyZ2V0LnZhbHVlXG4gICAgY29uc29sZS5sb2cocHJldldhdGNoZWQpXG4gICAgaWYgKCFwcmV2V2F0Y2hlZC5pbmNsdWRlcyhtb3ZpZSkpIHtcbiAgICAgIHByZXZXYXRjaGVkLnB1c2gobW92aWUpO1xuICAgIH0gZWxzZSB7XG4gICAgICBwcmV2V2F0Y2hlZCA9IHRoaXMucmVtb3ZlTW92aWUocHJldldhdGNoZWQsIG1vdmllKVxuICAgICAgfVxuICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgIHdhdGNoZWQ6IHByZXZXYXRjaGVkXG4gICAgICB9KTtcbiAgICB9XG4gIFxuXG4gIHJlbW92ZU1vdmllKHdhdGNoZWQsIG1vdmllKSB7XG4gICAgcmV0dXJuIHdhdGNoZWQuZmlsdGVyKGZ1bmN0aW9uKGVsZSkge1xuICAgICAgcmV0dXJuIGVsZSAhPSBtb3ZpZTtcbiAgICB9KVxuICB9XG4gIFxuICBoYW5kbGVJbnB1dChlKSB7XG4gICAgaWYoZS50YXJnZXQuaWQgPT09ICdhZGQnKSB7XG4gICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgYWRkSW5wdXQ6IGUudGFyZ2V0LnZhbHVlXG4gICAgICB9KVxuICAgIH0gZWxzZSBpZiAoZS50YXJnZXQuaWQgPT09ICdzZWFyY2gnKSB7XG4gICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgc2VhcmNoSW5wdXQ6IGUudGFyZ2V0LnZhbHVlXG4gICAgICB9KVxuICAgIH1cbiAgfTtcbiAgXG4gIGtleVByZXNzKGUpIHtcbiAgICBpZihlLmtleUNvZGUgPT09IDEzKSB7XG4gICAgICBpZihlLnRhcmdldC5pZCA9PT0gJ2FkZCcpIHtcbiAgICAgICAgdGhpcy5oYW5kbGVBZGQodGhpcy5zdGF0ZS5hZGRJbnB1dClcbiAgICAgIH0gZWxzZSBpZiAoZS50YXJnZXQuaWQgPT09ICdzZWFyY2gnKSB7XG4gICAgICAgIHRoaXMuaGFuZGxlU2VhcmNoKHRoaXMuc3RhdGUuc2VhcmNoSW5wdXQpXG4gICAgICB9XG4gICAgfTtcbiAgfTtcblxuICBoYW5kbGVTZWFyY2goKSB7XG4gICAgaWYgKHRoaXMuc3RhdGUuc2VhcmNoSW5wdXQgPT09ICcnKSB7XG4gICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgbW92aWVMaXN0OiB0aGlzLnN0YXRlLmZ1bGxMaXN0XG4gICAgICB9KSBcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB2YXIgbWF0Y2hlcyA9IFtdXG4gICAgZm9yKHZhciBpID0gMDsgaSA8IHRoaXMuc3RhdGUuZnVsbExpc3QubGVuZ3RoOyBpKyspIHtcbiAgICAgIGlmICh0aGlzLnN0YXRlLmZ1bGxMaXN0W2ldLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXModGhpcy5zdGF0ZS5zZWFyY2hJbnB1dC50b0xvd2VyQ2FzZSgpKSkge1xuICAgICAgICBtYXRjaGVzLnB1c2godGhpcy5zdGF0ZS5mdWxsTGlzdFtpXSlcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAobWF0Y2hlcy5sZW5ndGggPiAwKSB7XG4gICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgbW92aWVMaXN0OiBtYXRjaGVzLFxuICAgICAgICBzZWFyY2hJbnB1dDogJydcbiAgICAgIH0pXG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgICBtb3ZpZUxpc3Q6IFsnbW92aWUgbm90IGF2YWlsYWJsZSddLFxuICAgICAgICAgIHNlYXJjaElucHV0OiAnJ1xuICAgICAgICB9KVxuICAgICAgfVxuICAgIH07XG5cbiAgaGFuZGxlQWRkKCkge1xuICAgIGlmICh0aGlzLnN0YXRlLmFkZElucHV0ID09PSAnJykge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgIGZ1bGxMaXN0OiBbLi4udGhpcy5zdGF0ZS5mdWxsTGlzdCwgdGhpcy5zdGF0ZS5hZGRJbnB1dF0sXG4gICAgICBtb3ZpZUxpc3Q6IFsuLi50aGlzLnN0YXRlLmZ1bGxMaXN0LCB0aGlzLnN0YXRlLmFkZElucHV0XSxcbiAgICAgIGFkZElucHV0OiAnJ1xuICAgIH0pXG4gIH07XG4gIFxuICByZW5kZXIoKSB7XG4gICAgcmV0dXJuIChcbiAgICAgIDxkaXY+XG4gICAgICAgIDxkaXY+XG4gICAgICAgICAgPHNwYW4+XG4gICAgICAgICAgICA8YnV0dG9uIGNsYXNzTmFtZT1cImZpbHRlcl93YXRjaGVkXCIgb25DbGljaz17dGhpcy5maWx0ZXJXYXRjaGVkLmJpbmQodGhpcyl9PndhdGNoZWRcbiAgICAgICAgICAgIDwvYnV0dG9uPlxuICAgICAgICAgICAgPGJ1dHRvbiBjbGFzc05hbWU9XCJmaWx0ZXJfbm90X3dhdGNoZWRcIiBvbkNsaWNrPXt0aGlzLmZpbHRlclRvV2F0Y2guYmluZCh0aGlzKX0+d2F0Y2hcbiAgICAgICAgICAgIDwvYnV0dG9uPlxuICAgICAgICAgICAgPGJ1dHRvbiBjbGFzc05hbWU9XCJzaG93X2FsbFwiIG9uQ2xpY2s9e3RoaXMuc2hvd0FsbC5iaW5kKHRoaXMpfT5zaG93IGFsbDwvYnV0dG9uPlxuICAgICAgICAgIDwvc3Bhbj5cbiAgICAgICAgPC9kaXY+XG4gICAgICAgIDxBZGQgXG4gICAgICAgICAgdmFsdWU9e3RoaXMuc3RhdGUuYWRkSW5wdXR9IFxuICAgICAgICAgIGhhbmRsZUlucHV0PXt0aGlzLmhhbmRsZUlucHV0LmJpbmQodGhpcyl9IFxuICAgICAgICAgIGhhbmRsZUFkZD17dGhpcy5oYW5kbGVBZGQuYmluZCh0aGlzKX0gXG4gICAgICAgICAgb25LZXlEb3duPXt0aGlzLmtleVByZXNzLmJpbmQodGhpcyl9XG4gICAgICAgIC8+XG4gICAgICAgIDxTZWFyY2hcbiAgICAgICAgICB2YWx1ZT17dGhpcy5zdGF0ZS5zZWFyY2hJbnB1dH0gXG4gICAgICAgICAgaGFuZGxlSW5wdXQ9e3RoaXMuaGFuZGxlSW5wdXQuYmluZCh0aGlzKX0gXG4gICAgICAgICAgaGFuZGxlU2VhcmNoPXt0aGlzLmhhbmRsZVNlYXJjaC5iaW5kKHRoaXMpfSBcbiAgICAgICAgICBvbktleURvd249e3RoaXMua2V5UHJlc3MuYmluZCh0aGlzKX1cbiAgICAgICAgLz5cbiAgICAgICAgPE1vdmllTGlzdFxuICAgICAgICAgIG1vdmllTGlzdD17dGhpcy5zdGF0ZS5tb3ZpZUxpc3R9XG4gICAgICAgICAgd2F0Y2hlZENsaWNrPXt0aGlzLndhdGNoZWRDbGljay5iaW5kKHRoaXMpfVxuICAgICAgICAgIHdhdGNoZWQ9e3RoaXMuc3RhdGUud2F0Y2hlZH1cbiAgICAgICAgICBzaG93SW5mbz17dGhpcy5zaG93SW5mby5iaW5kKHRoaXMpfVxuICAgICAgICAgIHllYXI9e3RoaXMuc3RhdGUueWVhcn1cbiAgICAgICAgICBydW50aW1lPXt0aGlzLnN0YXRlLnJ1bnRpbWV9XG4gICAgICAgICAgbWV0YXNjb3JlPXt0aGlzLnN0YXRlLm1ldGFzY29yZX1cbiAgICAgICAgLz5cbiAgICAgIDwvZGl2PlxuICAgIClcbiAgfTtcblxufTtcblxuZXhwb3J0IGRlZmF1bHQgQXBwO1xuIl19